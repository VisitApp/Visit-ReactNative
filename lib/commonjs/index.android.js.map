{"version":3,"names":["getRunBeforeFirst","platform","runBeforeFirst","Platform","OS","console","log","VisitHealthView","baseUrl","token","id","phone","source","setSource","useState","useEffect","webviewRef","useRef","runBeforeStart","canGoBack","setCanGoBack","handleBack","useCallback","current","goBack","BackHandler","addEventListener","removeEventListener","flex","uri","headers","event","handleMessage","nativeEvent","defaultProps"],"sources":["index.android.js"],"sourcesContent":["import React, { useRef, useEffect, useState, useCallback } from 'react';\n\nimport { SafeAreaView, BackHandler, Platform } from 'react-native';\nimport {\n  requestActivityRecognitionPermission,\n  requestActivityData,\n  requestLocationPermission,\n  updateApiBaseUrl,\n  handleMessage,\n} from './VisitPluginAndroid';\nimport WebView from 'react-native-webview';\n\n\nfunction getRunBeforeFirst(platform) {\n  let runBeforeFirst = null;\n\n  if (Platform.OS == 'android') {\n    runBeforeFirst = `\n        window.isNativeApp = true;\n        window.platform = \"ANDROID\";\n        window.setSdkPlatform('ANDROID');\n        true; // note: this is required, or you'll sometimes get silent failures\n    `;\n  } else if (Platform.OS == 'ios') {\n    runBeforeFirst = `\n        window.isNativeApp = true;\n        window.platform = \"IOS\";\n        window.setSdkPlatform('IOS');\n        true; // note: this is required, or you'll sometimes get silent failures\n    `;\n  }\n  console.log('runBeforeFirst: ' + runBeforeFirst);\n\n  return runBeforeFirst;\n}\n\nconst VisitHealthView = ({ baseUrl, token, id,  phone }) => {\n  const [source, setSource] = useState('');\n  useEffect(() => {\n    setSource(`${baseUrl}?token=${token}&id=${id}&phone=${phone}`)\n  }, [id, token, baseUrl, phone])\n  const webviewRef = useRef(null);\n\n  const runBeforeStart = getRunBeforeFirst(Platform.OS);\n\n  const [canGoBack, setCanGoBack] = useState(false);\n\n  const handleBack = useCallback(() => {\n    if (canGoBack && webviewRef.current) {\n      webviewRef.current.goBack();\n      return true;\n    }\n    return false;\n  }, [canGoBack]);\n\n  useEffect(() => {\n    BackHandler.addEventListener('hardwareBackPress', handleBack);\n    return () => {\n      BackHandler.removeEventListener('hardwareBackPress', handleBack);\n    };\n  }, [handleBack]);\n\n  return (\n    <SafeAreaView style={{ flex: 1 }}>\n      {source ? <WebView\n        ref={webviewRef}\n        source={{\n          uri: source,\n          headers: {\n            platform: 'ANDROID',\n          },\n        }}\n        onMessage={(event) => handleMessage(event, webviewRef)}\n        injectedJavaScriptBeforeContentLoaded={runBeforeStart}\n        javaScriptEnabled={true}\n        onLoadProgress={(event) => setCanGoBack(event.nativeEvent.canGoBack)}\n      /> : null}\n    </SafeAreaView>\n  );\n};\n\nexport default VisitHealthView;\n\nVisitHealthView.defaultProps = {\n  id: '', token: '', baseUrl: '', phone: ''\n};\n"],"mappings":";;;;;;;AAAA;;AAEA;;AACA;;AAOA;;;;;;;;AAGA,SAASA,iBAAT,CAA2BC,QAA3B,EAAqC;EACnC,IAAIC,cAAc,GAAG,IAArB;;EAEA,IAAIC,qBAAA,CAASC,EAAT,IAAe,SAAnB,EAA8B;IAC5BF,cAAc,GAAI;AACtB;AACA;AACA;AACA;AACA,KALI;EAMD,CAPD,MAOO,IAAIC,qBAAA,CAASC,EAAT,IAAe,KAAnB,EAA0B;IAC/BF,cAAc,GAAI;AACtB;AACA;AACA;AACA;AACA,KALI;EAMD;;EACDG,OAAO,CAACC,GAAR,CAAY,qBAAqBJ,cAAjC;EAEA,OAAOA,cAAP;AACD;;AAED,MAAMK,eAAe,GAAG,QAAoC;EAAA,IAAnC;IAAEC,OAAF;IAAWC,KAAX;IAAkBC,EAAlB;IAAuBC;EAAvB,CAAmC;EAC1D,MAAM,CAACC,MAAD,EAASC,SAAT,IAAsB,IAAAC,eAAA,EAAS,EAAT,CAA5B;EACA,IAAAC,gBAAA,EAAU,MAAM;IACdF,SAAS,CAAE,GAAEL,OAAQ,UAASC,KAAM,OAAMC,EAAG,UAASC,KAAM,EAAnD,CAAT;EACD,CAFD,EAEG,CAACD,EAAD,EAAKD,KAAL,EAAYD,OAAZ,EAAqBG,KAArB,CAFH;EAGA,MAAMK,UAAU,GAAG,IAAAC,aAAA,EAAO,IAAP,CAAnB;EAEA,MAAMC,cAAc,GAAGlB,iBAAiB,CAACG,qBAAA,CAASC,EAAV,CAAxC;EAEA,MAAM,CAACe,SAAD,EAAYC,YAAZ,IAA4B,IAAAN,eAAA,EAAS,KAAT,CAAlC;EAEA,MAAMO,UAAU,GAAG,IAAAC,kBAAA,EAAY,MAAM;IACnC,IAAIH,SAAS,IAAIH,UAAU,CAACO,OAA5B,EAAqC;MACnCP,UAAU,CAACO,OAAX,CAAmBC,MAAnB;MACA,OAAO,IAAP;IACD;;IACD,OAAO,KAAP;EACD,CANkB,EAMhB,CAACL,SAAD,CANgB,CAAnB;EAQA,IAAAJ,gBAAA,EAAU,MAAM;IACdU,wBAAA,CAAYC,gBAAZ,CAA6B,mBAA7B,EAAkDL,UAAlD;;IACA,OAAO,MAAM;MACXI,wBAAA,CAAYE,mBAAZ,CAAgC,mBAAhC,EAAqDN,UAArD;IACD,CAFD;EAGD,CALD,EAKG,CAACA,UAAD,CALH;EAOA,oBACE,6BAAC,yBAAD;IAAc,KAAK,EAAE;MAAEO,IAAI,EAAE;IAAR;EAArB,GACGhB,MAAM,gBAAG,6BAAC,2BAAD;IACR,GAAG,EAAEI,UADG;IAER,MAAM,EAAE;MACNa,GAAG,EAAEjB,MADC;MAENkB,OAAO,EAAE;QACP7B,QAAQ,EAAE;MADH;IAFH,CAFA;IAQR,SAAS,EAAG8B,KAAD,IAAW,IAAAC,iCAAA,EAAcD,KAAd,EAAqBf,UAArB,CARd;IASR,qCAAqC,EAAEE,cAT/B;IAUR,iBAAiB,EAAE,IAVX;IAWR,cAAc,EAAGa,KAAD,IAAWX,YAAY,CAACW,KAAK,CAACE,WAAN,CAAkBd,SAAnB;EAX/B,EAAH,GAYF,IAbP,CADF;AAiBD,CA3CD;;eA6CeZ,e;;AAEfA,eAAe,CAAC2B,YAAhB,GAA+B;EAC7BxB,EAAE,EAAE,EADyB;EACrBD,KAAK,EAAE,EADc;EACVD,OAAO,EAAE,EADC;EACGG,KAAK,EAAE;AADV,CAA/B"}