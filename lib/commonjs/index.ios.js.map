{"version":3,"names":["LINKING_ERROR","Platform","select","ios","default","escapeChars","lt","gt","quot","apos","amp","unescapeHTML","str","replace","entity","entityCode","match","String","fromCharCode","parseInt","VisitHealthView","baseUrl","token","id","phone","source","setSource","useState","useEffect","VisitHealthRn","useMemo","NativeModules","Proxy","get","Error","webviewRef","useRef","apiBaseUrl","setApiBaseUrl","authToken","setAuthToken","hasLoadedOnce","setHasLoadedOnce","callSyncApi","useCallback","data","axios","post","headers","Authorization","then","res","console","log","catch","err","callEmbellishApi","apiManagerEmitter","NativeEventEmitter","subscription","addListener","reminder","callSyncData","length","remove","handleMessage","event","JSON","parse","nativeEvent","method","type","frequency","timestamp","authtoken","googleFitLastSync","gfHourlyLastSync","url","current","injectJavaScript","connectToAppleHealth","sleepTime","numberOfSteps","renderGraph","results","updateApiUrl","Linking","openURL","styles","webViewContainer","uri","webView","StyleSheet","create","flex","backgroundColor","defaultProps"],"sources":["index.ios.js"],"sourcesContent":["import axios from 'axios';\nimport React, {\n  useRef,\n  useEffect,\n  useState,\n  useCallback,\n  useMemo,\n} from 'react';\nimport {\n  StyleSheet,\n  SafeAreaView,\n  NativeModules,\n  NativeEventEmitter,\n  Linking,\n  Platform,\n} from 'react-native';\nimport { WebView } from 'react-native-webview';\n\nconst LINKING_ERROR =\n  `The package 'Visit-ReactNative' doesn't seem to be linked. Make sure: \\n\\n` +\n  Platform.select({ ios: \"- You have run 'pod install'\\n\", default: '' }) +\n  '- You rebuilt the app after installing the package\\n' +\n  '- You are not using Expo managed workflow\\n';\n\nconst escapeChars = {\n  lt: '<',\n  gt: '>',\n  quot: '\"',\n  apos: \"'\",\n  amp: '&',\n};\n\nconst unescapeHTML = (str) =>\n  // modified from underscore.string and string.js\n  str.replace(/\\&([^;]+);/g, (entity, entityCode) => {\n    let match;\n\n    if (entityCode in escapeChars) {\n      return escapeChars[entityCode];\n    } else if ((match = entityCode.match(/^#x([\\da-fA-F]+)$/))) {\n      return String.fromCharCode(parseInt(match[1], 16));\n    } else if ((match = entityCode.match(/^#(\\d+)$/))) {\n      return String.fromCharCode(~~match[1]);\n    } else {\n      return entity;\n    }\n  });\n\nconst VisitHealthView = ({ baseUrl, token, id,  phone }) => {\n  const [source, setSource] = useState('');\n  useEffect(()=>{\n    setSource(`${baseUrl}?token=${token}&id=${id}&phone=${phone}`)\n  },[id, token, baseUrl, phone])\n\n  const VisitHealthRn = useMemo(\n    () =>\n      NativeModules.VisitHealthRn\n        ? NativeModules.VisitHealthRn\n        : new Proxy(\n            {},\n            {\n              get() {\n                throw new Error(LINKING_ERROR);\n              },\n            }\n          ),\n    []\n  );\n\n  const webviewRef = useRef(null);\n  const [apiBaseUrl, setApiBaseUrl] = useState('');\n  const [authToken, setAuthToken] = useState('');\n  const [hasLoadedOnce, setHasLoadedOnce] = useState(false);\n\n  const callSyncApi = useCallback(\n    (data) =>\n      axios\n        .post(`${apiBaseUrl}/users/data-sync`, data, {\n          headers: {\n            Authorization: authToken,\n          },\n        })\n        .then((res) => console.log('callSyncData response,', res))\n        .catch((err) => console.log('callSyncData err,', { err })),\n    [apiBaseUrl, authToken]\n  );\n\n  const callEmbellishApi = useCallback(\n    (data) =>\n      axios\n        .post(`${apiBaseUrl}/users/embellish-sync`, data, {\n          headers: {\n            Authorization: authToken,\n          },\n        })\n        .then((res) => console.log('callEmbellishApi response,', res))\n        .catch((err) => console.log('callEmbellishApi err,', { err })),\n    [apiBaseUrl, authToken]\n  );\n\n  useEffect(() => {\n    const apiManagerEmitter = new NativeEventEmitter(VisitHealthRn);\n    const subscription = apiManagerEmitter.addListener(\n      'EventReminder',\n      (reminder) => {\n        if (reminder?.callSyncData && reminder?.callSyncData?.length) {\n          callSyncApi(reminder?.callSyncData[0]);\n        }\n        if (reminder?.callEmbellishApi && reminder?.callEmbellishApi?.length) {\n          callEmbellishApi(reminder?.callEmbellishApi[0]);\n        }\n      }\n    );\n    return () => {\n      subscription.remove();\n    };\n  }, [VisitHealthRn, callEmbellishApi, callSyncApi]);\n\n  const handleMessage = async (event) => {\n    const data = JSON.parse(unescapeHTML(event.nativeEvent.data));\n    const {\n      method,\n      type,\n      frequency,\n      timestamp,\n      apiBaseUrl,\n      authtoken,\n      googleFitLastSync,\n      gfHourlyLastSync,\n      url,\n    } = data;\n    console.log('handleMessage data is', data);\n    console.log(unescapeHTML(event.nativeEvent.data));\n    switch (method) {\n      case 'UPDATE_PLATFORM':\n        webviewRef.current?.injectJavaScript('window.setSdkPlatform(\"IOS\")');\n        break;\n      case 'CONNECT_TO_GOOGLE_FIT':\n        VisitHealthRn?.connectToAppleHealth((res) => {\n          if (res?.sleepTime || res?.numberOfSteps) {\n            webviewRef.current?.injectJavaScript(\n              `window.updateFitnessPermissions(true,${res?.numberOfSteps},${res?.sleepTime})`\n            );\n          } else {\n            webviewRef.current?.injectJavaScript(\n              'window.updateFitnessPermissions(true,0,0)'\n            );\n          }\n        });\n        break;\n      case 'GET_DATA_TO_GENERATE_GRAPH':\n        VisitHealthRn?.renderGraph(\n          { type, frequency, timestamp },\n          (err, results) => {\n            if (err) {\n              console.log('error initializing Healthkit: ', err);\n              return;\n            }\n            if (results[0]) {\n              console.log('results initializing Healthkit: ', results[0]);\n              webviewRef.current?.injectJavaScript(`window.${results[0]}`);\n            }\n          }\n        );\n        break;\n      case 'UPDATE_API_BASE_URL':\n        if (!hasLoadedOnce) {\n          console.log('apiBaseUrl is,', apiBaseUrl);\n          setApiBaseUrl(apiBaseUrl);\n          setAuthToken(authtoken);\n          VisitHealthRn?.updateApiUrl({ googleFitLastSync, gfHourlyLastSync });\n          setHasLoadedOnce(true);\n        }\n        break;\n\n      case 'OPEN_PDF':\n        Linking.openURL(url);\n        break;\n      case 'CLOSE_VIEW':\n        break;\n\n      default:\n        break;\n    }\n  };\n\n  return (\n    <SafeAreaView style={styles.webViewContainer}>\n      <WebView\n        ref={webviewRef}\n        source={{ uri: source }}\n        style={styles.webView}\n        javascriptEnabled\n        onMessage={handleMessage}\n      />\n    </SafeAreaView>\n  );\n};\n\nconst styles = StyleSheet.create({\n  webViewContainer: {\n    flex: 1,\n    backgroundColor: 'white',\n  },\n  webView: {\n    flex: 1,\n  },\n});\n\nexport default VisitHealthView;\n\nVisitHealthView.defaultProps = {\n  id:'', token:'', baseUrl:'', phone:''\n};\n"],"mappings":"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"}